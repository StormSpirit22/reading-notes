# RPC 基础

看到一篇讲 rpc 不错的文章，copy一部分自己留着看。以下内容转载自 [(近)万字总结，RPC 项目相关问题及解答](https://www.nowcoder.com/discuss/588903?from=zhnkw)。

### 什么是 RPC

RPC（Remote Procedure Call）—远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。比如两个不同的服务 A、B 部署在两台不同的机器上，那么服务 A 如果想要调用服务 B 中的某个方法该怎么办呢？使用 *HTTP请求* 当然可以，但是可能会比较慢而且一些优化做的并不好。 RPC 的出现就是为了解决这个问题。

最终解决的问题：**让分布式或者微服务系统中不同服务之间的调用像本地调用一样简单。**

### RPC 简要原理

![图片说明](https://uploadfiles.nowcoder.com/images/20210115/6796629_1610698824988/A5B6F28E3286E3F920698A1D904CE4B0) 

1. 服务消费方（client）调用以本地调用方式调用服务； 
2. client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体； 
3. client stub找到服务地址，并将消息发送到服务端； 
4. server stub收到消息后进行解码； 
5. server stub根据解码结果调用本地的服务； 
6. 本地服务执行并将结果返回给server stub； 
7. server stub将返回结果打包成消息并发送至消费方； 
8. client stub接收到消息，并进行解码； 
9. 服务消费方得到最终结果。



### 为什么用 RPC，不用 HTTP

首先需要指正，这两个并不是并行概念。RPC 是一种**设计**，就是为了解决**不同服务之间的调用问题**，完整的 RPC 实现一般会包含有 **传输协议** 和 **序列化协议** 这两个。

而 HTTP 是一种传输协议，RPC 框架完全可以使用 HTTP 作为传输协议，也可以直接使用 TCP，使用不同的协议一般也是为了适应不同的场景。

使用 TCP 和使用 HTTP 各有优势：

**传输效率**：

- TCP，通常自定义上层协议，可以让请求报文体积更小 
- HTTP：如果是基于HTTP 1.1 的协议，请求中会包含很多无用的内容 

**性能消耗**，主要在于序列化和反序列化的耗时

- TCP，可以基于各种序列化框架进行，效率比较高 
- HTTP，大部分是通过 json 来实现的，字节大小和序列化耗时都要更消耗性能 

**跨平台**：

- TCP：通常要求客户端和服务器为统一平台 
- HTTP：可以在各种异构系统上运行 

**总结**：
  RPC 的 TCP 方式主要用于公司内部的服务调用，性能消耗低，传输效率高。HTTP主要用于对外的异构环境，浏览器接口调用，APP接口调用，第三方接口调用等。
